<div class="portal-view-container" [style.--portal-color]="portal()?.primary_color || '#667eea'">
  <!-- Header -->
  <header class="portal-header">
    <div class="header-content">
      <!-- Left: Portal Info -->
      <div class="portal-info">
        @if (portal()) {
          <div class="portal-logo">
            @if (portal()!.logo) {
              <img [src]="portal()!.logo" [alt]="portal()!.title" />
            } @else {
              <app-icon name="Building" [size]="32" [strokeWidth]="2"></app-icon>
            }
          </div>
          <div class="portal-text">
            <h1>{{ portal()!.title }}</h1>
            @if (portal()!.description) {
              <p>{{ portal()!.description }}</p>
            }
          </div>
        }
      </div>

      <!-- Right: User Menu -->
      <div class="user-menu">
        @if (userContact()) {
          <div class="user-info">
            <span class="user-name">{{ getUserDisplayName() }}</span>
            <div class="user-avatar-placeholder">
              {{ getUserInitial() }}
            </div>
          </div>
        }
        <button class="btn-logout" (click)="exitToRegistration()" title="Salir">
          <app-icon name="LogOut" [size]="20" [strokeWidth]="2"></app-icon>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="portal-main">
    <!-- Loading State -->
    @if (loading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Cargando portal...</p>
      </div>
    }

    <!-- Error State -->
    @if (error() && !loading()) {
      <div class="error-container">
        <app-icon name="AlertCircle" [size]="64" [strokeWidth]="1.5"></app-icon>
        <p>{{ error() }}</p>
        <button class="btn-retry" (click)="retry()">
          Reintentar
        </button>
      </div>
    }

    <!-- Tools Grid -->
    @if (!loading() && !error() && portal()) {
      <div class="tools-section">
        <h2 class="tools-title">Servicios Disponibles</h2>

        @if (enabledTools().length > 0) {
          <div class="tools-grid">
            @for (tool of enabledTools(); track tool.tool_type) {
              <div
                class="tool-card"
                (click)="selectTool(tool)"
                [style.--tool-color]="getToolColor(tool)"
              >
                <div class="tool-icon">
                  <app-icon [name]="tool.icon || 'Circle'" [size]="32" [strokeWidth]="2"></app-icon>
                </div>

                <div class="tool-content">
                  <h3>{{ tool.label }}</h3>
                </div>

                <div class="tool-arrow">
                  <app-icon name="ChevronRight" [size]="24" [strokeWidth]="2"></app-icon>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="empty-tools">
            <app-icon name="Inbox" [size]="64" [strokeWidth]="1.5"></app-icon>
            <p>No hay herramientas disponibles en este portal</p>
          </div>
        }
      </div>
    }
  </main>
</div>
