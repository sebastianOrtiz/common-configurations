import{k as n,qa as l,w as t}from"./chunk-5KXQTZGH.js";var i=class o{currentUserSignal=t(null);isAuthenticatedSignal=t(!1);selectedPortalSignal=t(null);userContactSignal=t(null);isLoadingSignal=t(!1);globalErrorSignal=t(null);currentUser=this.currentUserSignal.asReadonly();isAuthenticated=this.isAuthenticatedSignal.asReadonly();selectedPortal=this.selectedPortalSignal.asReadonly();userContact=this.userContactSignal.asReadonly();isLoading=this.isLoadingSignal.asReadonly();globalError=this.globalErrorSignal.asReadonly();isPortalSelected=l(()=>this.selectedPortalSignal()!==null);hasUserContact=l(()=>this.userContactSignal()!==null);needsContactRegistration=l(()=>{let e=this.selectedPortalSignal(),a=this.userContactSignal();return e!==null&&!a});state=l(()=>({currentUser:this.currentUserSignal(),isAuthenticated:this.isAuthenticatedSignal(),selectedPortal:this.selectedPortalSignal(),userContact:this.userContactSignal(),isLoading:this.isLoadingSignal(),globalError:this.globalErrorSignal()}));constructor(){this.loadPersistedState()}setCurrentUser(e){this.currentUserSignal.set(e),this.isAuthenticatedSignal.set(!!e),e?localStorage.setItem("sp_current_user",JSON.stringify(e)):localStorage.removeItem("sp_current_user")}clearAuth(){this.currentUserSignal.set(null),this.isAuthenticatedSignal.set(!1),localStorage.removeItem("sp_current_user")}setSelectedPortal(e){this.selectedPortalSignal.set(e),e?localStorage.setItem("sp_selected_portal",JSON.stringify(e)):localStorage.removeItem("sp_selected_portal")}clearPortal(){this.selectedPortalSignal.set(null),localStorage.removeItem("sp_selected_portal")}setUserContact(e){this.userContactSignal.set(e),e?localStorage.setItem("sp_user_contact",JSON.stringify(e)):localStorage.removeItem("sp_user_contact")}clearUserContact(){this.userContactSignal.set(null),localStorage.removeItem("sp_user_contact")}setLoading(e){this.isLoadingSignal.set(e)}setGlobalError(e){this.globalErrorSignal.set(e)}clearGlobalError(){this.globalErrorSignal.set(null)}resetState(){this.clearAuth(),this.clearPortal(),this.clearUserContact(),this.clearGlobalError(),this.setLoading(!1)}loadPersistedState(){try{let e=localStorage.getItem("sp_current_user");if(e){let r=JSON.parse(e);this.currentUserSignal.set(r),this.isAuthenticatedSignal.set(!0)}let a=localStorage.getItem("sp_selected_portal");if(a){let r=JSON.parse(a);this.selectedPortalSignal.set(r)}let s=localStorage.getItem("sp_user_contact");if(s){let r=JSON.parse(s);this.userContactSignal.set(r)}}catch(e){console.error("Error loading persisted state:",e),localStorage.removeItem("sp_current_user"),localStorage.removeItem("sp_selected_portal"),localStorage.removeItem("sp_user_contact")}}clearPersistedState(){localStorage.removeItem("sp_current_user"),localStorage.removeItem("sp_selected_portal"),localStorage.removeItem("sp_user_contact")}static \u0275fac=function(a){return new(a||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{i as a};
