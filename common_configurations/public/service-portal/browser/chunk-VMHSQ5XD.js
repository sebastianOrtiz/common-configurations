import{l as c,ra as l,x as r}from"./chunk-ER7KAUPM.js";var t={currentUser:"sp_current_user",selectedPortal:"sp_selected_portal",userContact:"sp_user_contact",authToken:"sp_auth_token"};var g=class n{currentUserSignal=r(null);isAuthenticatedSignal=r(!1);selectedPortalSignal=r(null);userContactSignal=r(null);authTokenSignal=r(null);isLoadingSignal=r(!1);globalErrorSignal=r(null);currentUser=this.currentUserSignal.asReadonly();isAuthenticated=this.isAuthenticatedSignal.asReadonly();selectedPortal=this.selectedPortalSignal.asReadonly();userContact=this.userContactSignal.asReadonly();authToken=this.authTokenSignal.asReadonly();isLoading=this.isLoadingSignal.asReadonly();globalError=this.globalErrorSignal.asReadonly();isPortalSelected=l(()=>this.selectedPortalSignal()!==null);hasUserContact=l(()=>this.userContactSignal()!==null);isUserContactAuthenticated=l(()=>this.userContactSignal()!==null&&this.authTokenSignal()!==null);needsContactRegistration=l(()=>{let e=this.selectedPortalSignal(),a=this.userContactSignal();return e!==null&&!a});state=l(()=>({currentUser:this.currentUserSignal(),isAuthenticated:this.isAuthenticatedSignal(),selectedPortal:this.selectedPortalSignal(),userContact:this.userContactSignal(),authToken:this.authTokenSignal(),isUserContactAuthenticated:this.isUserContactAuthenticated(),isLoading:this.isLoadingSignal(),globalError:this.globalErrorSignal()}));constructor(){this.loadPersistedState()}setCurrentUser(e){this.currentUserSignal.set(e),this.isAuthenticatedSignal.set(!!e),e?localStorage.setItem(t.currentUser,JSON.stringify(e)):localStorage.removeItem(t.currentUser)}clearAuth(){this.currentUserSignal.set(null),this.isAuthenticatedSignal.set(!1),localStorage.removeItem(t.currentUser)}setSelectedPortal(e){this.selectedPortalSignal.set(e),e?localStorage.setItem(t.selectedPortal,JSON.stringify(e)):localStorage.removeItem(t.selectedPortal)}clearPortal(){this.selectedPortalSignal.set(null),localStorage.removeItem(t.selectedPortal)}setUserContact(e,a){this.userContactSignal.set(e),e?localStorage.setItem(t.userContact,JSON.stringify(e)):localStorage.removeItem(t.userContact),a&&this.setAuthToken(a)}setAuthToken(e){this.authTokenSignal.set(e),e?localStorage.setItem(t.authToken,e):localStorage.removeItem(t.authToken)}getAuthToken(){return this.authTokenSignal()}clearUserContact(){this.userContactSignal.set(null),this.authTokenSignal.set(null),localStorage.removeItem(t.userContact),localStorage.removeItem(t.authToken)}setLoading(e){this.isLoadingSignal.set(e)}setGlobalError(e){this.globalErrorSignal.set(e)}clearGlobalError(){this.globalErrorSignal.set(null)}resetState(){this.clearAuth(),this.clearPortal(),this.clearUserContact(),this.clearGlobalError(),this.setLoading(!1)}loadPersistedState(){try{let e=localStorage.getItem(t.currentUser);if(e){let o=JSON.parse(e);this.currentUserSignal.set(o),this.isAuthenticatedSignal.set(!0)}let a=localStorage.getItem(t.selectedPortal);if(a){let o=JSON.parse(a);this.selectedPortalSignal.set(o)}let s=localStorage.getItem(t.userContact);if(s){let o=JSON.parse(s);this.userContactSignal.set(o)}let i=localStorage.getItem(t.authToken);i&&this.authTokenSignal.set(i)}catch(e){console.error("Error loading persisted state:",e),this.clearPersistedState()}}clearPersistedState(){localStorage.removeItem(t.currentUser),localStorage.removeItem(t.selectedPortal),localStorage.removeItem(t.userContact),localStorage.removeItem(t.authToken)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{g as a};
