import{a as o,b as p}from"./chunk-6XSXRL5Z.js";import{c as a,d as n,i as s,l as c,p as r}from"./chunk-HCJ7C2DO.js";var u=class i{frappeApi=r(o);stateService=r(p);currentUser=this.stateService.currentUser;isAuthenticated=this.stateService.isAuthenticated;isLoading=this.stateService.isLoading;constructor(){this.checkAuthStatus()}checkAuthStatus(){return this.stateService.setLoading(!0),this.frappeApi.getCurrentUser().pipe(n(e=>{if(e.success&&e.message){let t=e.message;if(t&&t!=="Guest")return this.stateService.setCurrentUser({name:t,email:t}),this.stateService.setLoading(!1),!0}return this.stateService.setCurrentUser(null),this.stateService.setLoading(!1),!1}))}login(e){return this.stateService.setLoading(!0),this.frappeApi.login(e.usr,e.pwd).pipe(s(t=>{t.success?this.checkAuthStatus().subscribe():this.stateService.setLoading(!1)}))}logout(){return this.stateService.setLoading(!0),this.frappeApi.logout().pipe(s(()=>{this.stateService.resetState(),this.frappeApi.clearApiToken()}))}getUserDetails(){let e=this.stateService.currentUser();return e?this.frappeApi.getDoc("User",e.email).pipe(s(t=>{t.success&&t.data&&this.stateService.setCurrentUser(t.data)})):a({success:!1,error:"Not authenticated"})}setApiToken(e){this.frappeApi.setApiToken(e),this.checkAuthStatus().subscribe()}static \u0275fac=function(t){return new(t||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{u as a};
