import{a as l}from"./chunk-KPH2NHHK.js";import{d as a,i as o,l as n,o as c}from"./chunk-JFEUYR63.js";var i="common_configurations.api.contacts",p="common_configurations.api.portals",u="common_configurations.api.auth",h=class s{constructor(t){this.frappeApi=t}getPortal(t){return this.callApiGet(`${p}.get_portal`,{portal_name:t})}getActivePortals(){return this.callApiGet(`${p}.get_portals`)}createUserContact(t){return this.callApiPost(`${i}.create_user_contact`,{data:JSON.stringify(t),honeypot:""}).pipe(o(e=>{e?.auth_token&&!e?.requires_otp&&this.frappeApi.setUserContactToken(e.auth_token)}))}updateUserContact(t,e){return this.callApiPost(`${i}.update_user_contact`,{name:t,data:JSON.stringify(e),honeypot:""})}getUserContactByDocument(t){return this.callApiGet(`${i}.get_user_contact_by_document`,{document:t}).pipe(o(e=>{e?.auth_token&&!e?.requires_otp&&this.frappeApi.setUserContactToken(e.auth_token)}))}setAuthToken(t){this.frappeApi.setUserContactToken(t)}getAuthenticatedUserContact(){return this.callApiGet(`${u}.get_authenticated_user_contact`)}logoutUserContact(){return this.callApiPost(`${u}.logout_user_contact`,{honeypot:""}).pipe(o(()=>{this.frappeApi.clearUserContactToken()}))}getToolTypes(){return this.frappeApi.getList("Tool Type",[["is_active","=",1]],["*"],0,100).pipe(a(t=>{if(!t.success||!t.data)throw new Error(t.error||"Failed to load tool types");return t.data}))}callApiGet(t,e){return this.frappeApi.callMethod(t,e,!0).pipe(a(r=>{if(!r.success&&r.message===void 0)throw new Error(r.error||"API call failed");return r.message}))}callApiPost(t,e){return this.frappeApi.callMethod(t,e,!1).pipe(a(r=>{if(!r.success&&r.message===void 0)throw new Error(r.error||"API call failed");return r.message}))}getUserContactFields(){return this.callApiGet(`${i}.get_user_contact_fields`)}static \u0275fac=function(e){return new(e||s)(c(l))};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
